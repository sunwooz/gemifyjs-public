/*! AutoFill 2.1.0
 * Â©2008-2015 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     AutoFill
 * @description Add Excel like click and drag auto-fill options to DataTables
 * @version     2.1.0
 * @file        dataTables.autoFill.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2015 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(e){return t(e,window,document)}):"object"==typeof exports?module.exports=function(e,o){return e||(e=window),o&&o.fn.dataTable||(o=require("datatables.net")(e,o).$),t(o,e,e.document)}:t(jQuery,window,document)}(function(t,e,o,i){"use strict";var n=t.fn.dataTable,l=0,s=function(e,o){if(!n.versionCheck||!n.versionCheck("1.10.8"))throw"Warning: AutoFill requires DataTables 1.10.8 or greater";this.c=t.extend(!0,{},n.defaults.autoFill,s.defaults,o),this.s={dt:new n.Api(e),namespace:".autoFill"+l++,scroll:{},scrollInterval:null,handle:{height:0,width:0}},this.dom={handle:t('<div class="dt-autofill-handle"/>'),select:{top:t('<div class="dt-autofill-select top"/>'),right:t('<div class="dt-autofill-select right"/>'),bottom:t('<div class="dt-autofill-select bottom"/>'),left:t('<div class="dt-autofill-select left"/>')},background:t('<div class="dt-autofill-background"/>'),list:t('<div class="dt-autofill-list">'+this.s.dt.i18n("autoFill.info","")+"<ul/></div>"),dtScroll:null,offsetParent:null},this._constructor()};return t.extend(s.prototype,{_constructor:function(){var e=this,i=this.s.dt,n=t("div.dataTables_scrollBody",this.s.dt.table().container());n.length&&(this.dom.dtScroll=n,"static"===n.css("position")&&n.css("position","relative")),this._focusListener(),this.dom.handle.on("mousedown",function(t){return e._mousedown(t),!1}),i.on("destroy.autoFill",function(){i.off(".autoFill"),t(i.table().body()).off(e.s.namespace),t(o.body).off(e.s.namespace)})},_attach:function(e){var o=this.s.dt,i=o.cell(e).index(),n=this.dom.handle,l=this.s.handle;if(!i||-1===o.columns(this.c.columns).indexes().indexOf(i.column))return void this._detach();this.dom.offsetParent||(this.dom.offsetParent=t(e).offsetParent()),l.height&&l.width||(n.appendTo("body"),l.height=n.outerHeight(),l.width=n.outerWidth());var s=t(e).position();this.dom.attachedTo=e,n.css({top:s.top+e.offsetHeight-l.height,left:s.left+e.offsetWidth-l.width}).appendTo(this.dom.offsetParent)},_actionSelector:function(e){var o=this,i=this.s.dt,n=s.actions,l=[];if(t.each(n,function(t,o){o.available(i,e)&&l.push(t)}),1===l.length&&this.c.alwaysAsk===!1){var a=n[l[0]].execute(i,e);this._update(a,e)}else{var r=this.dom.list.children("ul").empty();l.push("cancel"),t.each(l,function(l,a){r.append(t("<li/>").append('<div class="dt-autofill-question">'+n[a].option(i,e)+"<div>").append(t('<div class="dt-autofill-button">').append(t('<button class="'+s.classes.btn+'">'+i.i18n("autoFill.button","&gt;")+"</button>").on("click",function(){var l=n[a].execute(i,e,t(this).closest("li"));o._update(l,e),o.dom.background.remove(),o.dom.list.remove()}))))}),this.dom.background.appendTo("body"),this.dom.list.appendTo("body"),this.dom.list.css("margin-top",this.dom.list.outerHeight()/2*-1)}},_detach:function(){this.dom.attachedTo=null,this.dom.handle.detach()},_drawSelection:function(e){var o=this.s.dt,i=this.s.start,n=t(this.dom.start),l=t(e),s={row:o.rows({page:"current"}).nodes().indexOf(l.parent()[0]),column:l.index()};if(o.cell(l).any()&&-1!==o.columns(this.c.columns).indexes().indexOf(s.column)){this.s.end=s;var a,r,d,c,u,h;a=i.row<s.row?n:l,r=i.row<s.row?l:n,d=i.column<s.column?n:l,c=i.column<s.column?l:n,a=a.position().top,d=d.position().left,u=r.position().top+r.outerHeight()-a,h=c.position().left+c.outerWidth()-d;var f=this.dom.dtScroll;f&&(a+=f.scrollTop(),d+=f.scrollLeft());var p=this.dom.select;p.top.css({top:a,left:d,width:h}),p.left.css({top:a,left:d,height:u}),p.bottom.css({top:a+u,left:d,width:h}),p.right.css({top:a,left:d+h,height:u})}},_editor:function(t){var e=this.s.dt,o=this.c.editor;if(o){for(var n={},l=[],s=o.fields(),a=0,r=t.length;r>a;a++)for(var d=0,c=t[a].length;c>d;d++){var u=t[a][d],h=e.settings()[0].aoColumns[u.index.column],f=h.editField;if(f===i)for(var p=h.mData,m=0,v=s.length;v>m;m++){var g=o.field(s[m]);if(g.dataSrc()===p){f=g.name();break}}if(!f)throw"Could not automatically determine field data. Please see https://datatables.net/tn/11";n[f]||(n[f]={});var b=e.row(u.index.row).id();n[f][b]=u.set,l.push(u.index)}o.bubble(l,!1).multiSet(n).submit()}},_emitEvent:function(e,o){this.s.dt.iterator("table",function(i){t(i.nTable).triggerHandler(e+".dt",o)})},_focusListener:function(){var e=this,i=this.s.dt,n=this.s.namespace,l=null!==this.c.focus?this.c.focus:i.settings()[0].keytable?"focus":"hover";"focus"===l?i.on("key-focus.autoFill",function(t,o,i){e._attach(i.node())}).on("key-blur.autoFill",function(){e._detach()}):"click"===l?(t(i.table().body()).on("click"+n,"td, th",function(){e._attach(this)}),t(o.body).on("click"+n,function(o){t(o.target).parents().filter(i.table().body()).length||e._detach()})):t(i.table().body()).on("mouseenter"+n,"td, th",function(){e._attach(this)}).on("mouseleave"+n,function(o){t(o.relatedTarget).hasClass("dt-autofill-handle")||e._detach()})},_mousedown:function(i){var n=this,l=this.s.dt;this.dom.start=this.dom.attachedTo,this.s.start={row:l.rows({page:"current"}).nodes().indexOf(t(this.dom.start).parent()[0]),column:t(this.dom.start).index()},t(o.body).on("mousemove.autoFill",function(t){n._mousemove(t)}).on("mouseup.autoFill",function(t){n._mouseup(t)});var s=this.dom.select,a=t(this.s.dt.table().body()).offsetParent();s.top.appendTo(a),s.left.appendTo(a),s.right.appendTo(a),s.bottom.appendTo(a),this._drawSelection(this.dom.start,i),this.dom.handle.css("display","none");var r=this.dom.dtScroll;this.s.scroll={windowHeight:t(e).height(),windowWidth:t(e).width(),dtTop:r?r.offset().top:null,dtLeft:r?r.offset().left:null,dtHeight:r?r.outerHeight():null,dtWidth:r?r.outerWidth():null}},_mousemove:function(t){var e=(this.s.dt,t.target.nodeName.toLowerCase());"td"!==e&&"th"!==e||(this._drawSelection(t.target,t),this._shiftScroll(t))},_mouseup:function(){t(o.body).off(".autoFill");var e=this.s.dt,i=this.dom.select;i.top.remove(),i.left.remove(),i.right.remove(),i.bottom.remove(),this.dom.handle.css("display","block");var n=this.s.start,l=this.s.end;if(n.row!==l.row||n.column!==l.column){for(var s=this._range(n.row,l.row),a=this._range(n.column,l.column),r=[],d=0;d<s.length;d++)r.push(t.map(a,function(t){var o=e.cell(":eq("+s[d]+")",t+":visible",{page:"current"});return{cell:o,data:o.data(),index:o.index()}}));this._actionSelector(r)}},_range:function(t,e){var o,i=[];if(e>=t)for(o=t;e>=o;o++)i.push(o);else for(o=t;o>=e;o--)i.push(o);return i},_shiftScroll:function(t){var e,i,n,l,s=this,a=(this.s.dt,this.s.scroll),r=!1,d=5,c=65,u=t.pageY-o.body.scrollTop,h=t.pageX-o.body.scrollLeft;c>u?e=-1*d:u>a.windowHeight-c&&(e=d),c>h?i=-1*d:h>a.windowWidth-c&&(i=d),null!==a.dtTop&&t.pageY<a.dtTop+c?n=-1*d:null!==a.dtTop&&t.pageY>a.dtTop+a.dtHeight-c&&(n=d),null!==a.dtLeft&&t.pageX<a.dtLeft+c?l=-1*d:null!==a.dtLeft&&t.pageX>a.dtLeft+a.dtWidth-c&&(l=d),e||i||n||l?(a.windowVert=e,a.windowHoriz=i,a.dtVert=n,a.dtHoriz=l,r=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&r&&(this.s.scrollInterval=setInterval(function(){if(a.windowVert&&(o.body.scrollTop+=a.windowVert),a.windowHoriz&&(o.body.scrollLeft+=a.windowHoriz),a.dtVert||a.dtHoriz){var t=s.dom.dtScroll[0];a.dtVert&&(t.scrollTop+=a.dtVert),a.dtHoriz&&(t.scrollLeft+=a.dtHoriz)}},20))},_update:function(t,e){if(t!==!1){var o,i=this.s.dt;this._emitEvent("preAutoFill",[i,e]),this._editor(e);var n=null!==this.c.update?this.c.update:!this.c.editor;if(n){for(var l=0,s=e.length;s>l;l++)for(var a=0,r=e[l].length;r>a;a++)o=e[l][a],o.cell.data(o.set);i.draw(!1)}this._emitEvent("autoFill",[i,e])}}}),s.actions={increment:{available:function(e,o){return t.isNumeric(o[0][0].data)},option:function(t){return t.i18n("autoFill.increment",'Increment / decrement each cell by: <input type="number" value="1">')},execute:function(e,o,i){for(var n=1*o[0][0].data,l=1*t("input",i).val(),s=0,a=o.length;a>s;s++)for(var r=0,d=o[s].length;d>r;r++)o[s][r].set=n,n+=l}},fill:{available:function(){return!0},option:function(t,e){return t.i18n("autoFill.fill","Fill all cells with <i>"+e[0][0].data+"</i>")},execute:function(t,e){for(var o=e[0][0].data,i=0,n=e.length;n>i;i++)for(var l=0,s=e[i].length;s>l;l++)e[i][l].set=o}},fillHorizontal:{available:function(t,e){return e.length>1&&e[0].length>1},option:function(t){return t.i18n("autoFill.fillHorizontal","Fill cells horizontally")},execute:function(t,e){for(var o=0,i=e.length;i>o;o++)for(var n=0,l=e[o].length;l>n;n++)e[o][n].set=e[o][0].data}},fillVertical:{available:function(t,e){return e.length>1&&e[0].length>1},option:function(t){return t.i18n("autoFill.fillVertical","Fill cells vertically")},execute:function(t,e){for(var o=0,i=e.length;i>o;o++)for(var n=0,l=e[o].length;l>n;n++)e[o][n].set=e[0][n].data}},cancel:{available:function(){return!1},option:function(t){return t.i18n("autoFill.cancel","Cancel")},execute:function(){return!1}}},s.version="2.1.0",s.defaults={alwaysAsk:!1,focus:null,columns:"",update:null,editor:null},s.classes={btn:"btn"},t(o).on("preInit.dt.autofill",function(e,o){if("dt"===e.namespace){var i=o.oInit.autoFill,l=n.defaults.autoFill;if(i||l){var a=t.extend({},i,l);i!==!1&&new s(o,a)}}}),n.AutoFill=s,n.AutoFill=s,s});